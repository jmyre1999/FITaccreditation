{% extends 'base.html' %} <!-- IMPORTANT -->
{% load staticfiles %}

{% block base_body %} <!-- Will replace base_body block in base.html -->
<body>
    <body style="background-color:#880000;">
    <div class="container">
        <div class="row">
            <!-- WIP -->
            <div class="col-lg-12 col-md-12 form-container">
                <div class="col-lg-3 col-md-12 col-sm-9 col-xs-12 form-box text-center">
                    <div class="logo mb-3 my-4">
                        <img src="{% static 'img/logo-white.png' %}" width="150px">
                    </div>
                    <div class="heading mb-4">
                        <h4>Submission Server</h4>
                    </div>
                    {% if courses.count > 0 %}
                        <form method="POST" enctype="multipart/form-data">
                            {% csrf_token %}
                            {% if error %}
                                <div class="alert alert-danger">
                                    <strong>{{ error_message }}!</strong>
                                </div>
                            {% endif %}
                            <!-- Class dropdown -->
                            <select name="course" id="course_select" class="custom-select-lg my-4">
                                <option value="" {% if linked_course_pk == -1 %}selected{% endif %}>Select Course</option>
                                {% for course in courses %}
                                    <option value="{{ course.pk }}" {% if linked_course_pk == course.pk %}selected{% endif %}>{{ course.title }}</option>
                                {% endfor %}
                            </select>
                            <!-- Outcome dropdown -->
                            <select name="outcome" id="outcome_select" class="custom-select-lg my-4">
                                <option value="" selected>Select Outcome</option>
                                <!-- Options loaded with ajax -->
                            </select>
                            <!-- Upload File -->
                            <div class="form-group">
                                <span class="btn btn-default btn-file my-4 text-white">
                                    <input id="upload_file" name="upload" type="file" class="file" multiple data-show-upload="true" data-show-caption="true">
                                </span>
                            </div>
                            <!-- Comment area -->
                            <div class="form-group">
                                <label for="comment" class="control-label text-white">Comment:</label>
                                <textarea class="form-control" name="comment" id="comment"></textarea>
                            </div> 

                            <div class="text-center mb-3">
                                <button type="submit" class="btn btn-primary btn-lg my-4">Submit</button>
                            </div>
                        </form>
                    {% else %}
                        <span class="text-white">You are not assigned to any courses</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</body>

<script type="text/javascript">
    $('#course_select').change(function(){
        if($('#course_select').val() != '') {
            ajaxPost('/submission/get_outcomes_ajax/', {
                'selected_course_pk': $('#course_select').val(),
            }, function(response){
                if(response != null) {
                    var outcome_name;
                    var outcome_id;
                    $('#outcome_select').empty();
                    $('#outcome_select').append('<option value="" selected>Select Outcome</option>');
                    for(var i=0;i<response.length;i++){
                        outcome_name = response[i]['name'];
                        outcome_id = response[i]['pk'];
                        $('#outcome_select').append('<option value="' + outcome_id + '">' + outcome_name + '</option>');
                    }
                }
            });
        }
    });

    $('#course_select').change();
</script>
{% endblock base_body %}